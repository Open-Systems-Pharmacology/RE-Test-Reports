---
title: "Reporting Engine Test Reports"
author: "Open System Pharmacology"
date: "`r Sys.Date()`"
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
```

<!-- 
Run testthat and get list of test results 
Note that "test_local" runs the scripts in ./R and then performs the tests
testResults includes a list per test script, which contains the following results
file, context, test, nb, failed, skipped, error, warning, user, system, real, passed, result

Turning the list to data.frame and extracting the relevant data will give a great overview of the test results
-->

```{r, include=FALSE}
# Remove previous tests
unlink("./tests/Reports", recursive = TRUE, force = TRUE)

testResultsRaw <- testthat::test_local(reporter = testthat::ListReporter)
testResultsRaw <- as.data.frame(testResultsRaw)
testResults <- testResultsRaw %>% 
  mutate(
    Report = paste0("[", context, "](./tests/Reports/", context, ")"),
    Test = test,
    Status = if_else(
      failed > 0, 
      "![](https://img.shields.io/badge/%E2%9A%A0-Failed%20tests-red)",
      ifelse(
        warning > 0,
        "![](https://img.shields.io/badge/%E2%9A%A0-Warned%20tests-red)",
        "![](https://img.shields.io/badge/%E2%9C%93-Passed%20tests-success)"
      )),
    Duration = real,
    N = nb,
    Success = paste0("![](https://geps.dev/progress/", round(100*passed/nb, 0),")"),
    Warning = 100*warning/nb,
    Failed = 100*failed/nb
  ) %>%
  select(Report,Test,Status,Duration,N,Success,Warning,Failed)

globalResult <- round(100*sum(testResultsRaw$passed)/sum(testResultsRaw$nb), 0)
```

|Global Success Rate| ![](https://geps.dev/progress/`r globalResult`)|
|---|---|

## Overview

```{r, results='asis'}
names(testResults) <- c("Report","Test","Status","Duration [s]","N","Success [%]","Warning [%]","Failed [%]")

knitr::kable(testResults)
```

## Reports

Users can find the reports and their description in the [/Reports](./Reports) folder.
Currently, the following reports are available:

```{r, results='asis'}
availableReports <- list.dirs("./Reports", recursive = FALSE, full.names = FALSE)
cat(paste0("* [", availableReports, "](./Reports/", availableReports, "/Report.md)"), sep = "\n")
```


## Using report scripts as template

Users can find the R code for creating the reports in the [/R](./R) folder.
Currently, the following scripts are available:

```{r, results='asis'}
availableScripts <- list.files("./R", pattern = ".R")
cat(paste0("* [", availableScripts, "](./R/", availableScripts, ")"), sep = "\n")
```

Models and Observed Data are respectively available in the [Models](./Models) and [Data](./ObservedData) folders.

